var acrolinxLibs;!function(a){"use strict";var b=window.acrolinxLibs||{};a.Q=b.Q||window.Q,a.$=b.$||window.$,a._=b._||window._}(acrolinxLibs||(acrolinxLibs={}));var acrolinx;!function(a){var b;!function(a){"use strict";a.SoftwareComponentCategory={MAIN:"MAIN",DEFAULT:"DEFAULT",DETAIL:"DETAIL"},a.ErrorCodes={checkIsAlreadyRunning:"checkIsAlreadyRunning",userIsNotLoggedIn:"userIsNotLoggedIn",sidebarNotReadyForCheck:"sidebarNotReadyForCheck",checkCanceledByUser:"checkCanceledByUser",base64EncodedGzippedUnsupported:"base64EncodedGzippedUnsupported"}}(b=a.sidebar||(a.sidebar={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){"use strict";function b(a){var b=[],c=0,d=0;return a.forEach(function(a){var e=a[0],f=a[1];switch(e){case DIFF_EQUAL:c+=f.length;break;case DIFF_DELETE:c+=f.length,d-=f.length;break;case DIFF_INSERT:d+=f.length;break;default:throw new Error("Illegal Diff Action: "+e)}b.push({oldPosition:c,diffOffset:d})}),b}function c(a,c,f){function g(a){var b=d.findIndex(i,function(b){return b.oldPosition>a});return b>0?i[b-1].diffOffset:i.length>1&&-1===b?h[i.length-1][0]===DIFF_EQUAL?i[i.length-1].diffOffset:i[i.length-2].diffOffset:0===b?i[0].diffOffset:0}if(d.isEmpty(f))return[];var h=e.diff_main(a,c),i=b(h),j=f.map(function(a){return{replacement:a.replacement,range:a.range,content:a.content,foundOffset:a.range[0]+g(a.range[0]),flagLength:a.range[1]-a.range[0]}});return j[0].flagLength=f[f.length-1].range[1]-f[0].range[0],j}var d=acrolinxLibs._,e=new diff_match_patch;(function(){function a(){}return a})();a.createOffsetMappingArray=b,a.lookupMatches=c}(b=a.diffbased||(a.diffbased={}))}(b=a.lookup||(a.lookup={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(b){var c;!function(b){"use strict";function c(a,b){a.deleteContents(),b&&a.insertNode(a.createContextualFragment(b))}var d=a.plugins.lookup.diffbased.lookupMatches,e=acrolinxLibs._,f=function(){function a(a){this.lookupMatches=d,this.editorId=a.editorId,this.editor=null,a.lookupMatches&&(this.lookupMatches=a.lookupMatches)}return a.prototype.getEditor=function(){return null===this.editor&&CKEDITOR.instances.hasOwnProperty(this.editorId)&&(this.editor=CKEDITOR.instances[this.editorId]),this.editor},a.prototype.getEditorDocument=function(){try{return this.getEditor().document.$}catch(a){throw a}},a.prototype.getCurrentText=function(){try{return rangy.innerText(this.getEditorDocument())}catch(a){throw a}},a.prototype.getHTML=function(){return this.getEditor().getData()},a.prototype.createRange=function(a,b){var c=this.getEditorDocument(),d=rangy.createRange(c);return d.setStart(c,0),d.setEnd(c,0),d.moveStart("character",a),d.moveEnd("character",b),d},a.prototype.selectText=function(a,b){var c=this.createRange(a,b),d=rangy.getSelection(this.getEditorDocument());return d.setSingleRange(c),c},a.prototype.scrollAndSelect=function(a){var b,c,d,e,f,g,h;if(b=a[0].foundOffset,c=a[0].flagLength,f=this.selectText(b,c),d=this.getEditor().getSelection())try{d.scrollIntoView()}catch(i){}return h=this.getEditorDocument(),e=rangy.getSelection(h),g=rangy.createRange(h),g.setStart(f.startContainer,f.startOffset),g.setEnd(f.endContainer,f.endOffset),e.setSingleRange(g),g},a.prototype.extractHTMLForCheck=function(){if(this.html=this.getHTML(),this.currentHtmlChecking=this.html,"wysiwyg"===this.editor.mode)this.checkStartTime=Date.now(),""===this.html&&(this.html="<span> </span>");else{if(!this.isCheckingNow)return{error:"Action is not permitted in Source mode."};this.isCheckingNow=!1}return{html:this.html}},a.prototype.registerCheckCall=function(a){},a.prototype.registerCheckResult=function(a){return this.isCheckingNow=!1,this.currentHtmlChecking=this.html,this.prevCheckedHtml=this.currentHtmlChecking,[]},a.prototype.selectRanges=function(a,b){"wysiwyg"===this.editor.mode?this.selectMatches(a,b):window.alert("Action is not permitted in Source mode.")},a.prototype.selectMatches=function(a,b){var c=this.lookupMatches(this.currentHtmlChecking,this.getCurrentText(),b);if(e.isEmpty(c))throw"Selected flagged content is modified.";return this.scrollAndSelect(c),c},a.prototype.replaceRanges=function(a,b){var d=1;if("wysiwyg"===this.editor.mode)try{var f=this.selectMatches(a,b);this.selectMatches(a,f);var g=f[0].foundOffset+f[0].flagLength-1<this.getCurrentText().length;g&&(f[0].foundOffset+=d,f[0].flagLength-=d);var h=this.scrollAndSelect(f),i=e.map(f,"replacement").join("");c(h,i),g&&(d>0&&(this.selectText(f[0].foundOffset-d,d),rangy.getSelection(this.getEditorDocument()).nativeSelection.deleteFromDocument()),f[0].foundOffset-=d,f[0].flagLength+=d),this.selectText(f[0].foundOffset,i.length)}catch(j){return void console.log(j)}else window.alert("Action is not permitted in Source mode.")},a}();b.CKEditorAdapter=f}(c=b.adapter||(b.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(b){var c;!function(b){var c=a.plugins.lookup.diffbased.lookupMatches,d=acrolinxLibs.$,e=acrolinxLibs._,f=function(){function a(a){this.lookupMatches=c,this.config=a,this.element=document.getElementById(a.editorId),a.lookupMatches&&(this.lookupMatches=a.lookupMatches)}return a.prototype.registerCheckCall=function(a){},a.prototype.registerCheckResult=function(a){return[]},a.prototype.getHTML=function(){return this.element.innerHTML},a.prototype.getEditorDocument=function(){try{return this.element.ownerDocument}catch(a){throw a}},a.prototype.getCurrentText=function(){try{return rangy.innerText(this.element)}catch(a){throw a}},a.prototype.extractHTMLForCheck=function(){return this.html=this.getHTML(),this.currentHtmlChecking=this.html,{html:this.html}},a.prototype.selectText=function(a,b){var c=this.getEditorDocument(),d=rangy.getSelection(c),e=rangy.createRange(c);return e.setStart(this.element,0),e.moveStart("character",a),e.moveEnd("character",b),d.setSingleRange(e),e},a.prototype.scrollIntoView2=function(a){var b=a.getRangeAt(0),c=b.cloneRange();c.collapse();var d=document.createElement("span");c.startContainer.parentNode.insertBefore(d,c.startContainer),d.scrollIntoView(),d.remove()},a.prototype.scrollAndSelect=function(a){var b,c,e,f,g;if(b=a[0].foundOffset,c=a[0].flagLength,f=this.selectText(b,c),e=rangy.getSelection(this.getEditorDocument()))try{this.scrollIntoView2(e);var h=d("#wp-content-editor-container");h.length>0&&window.scrollBy(0,-50)}catch(i){console.log("Scrolling Error!")}g=this.selectText(b,c)},a.prototype.selectRanges=function(a,b){this.selectMatches(a,b)},a.prototype.selectMatches=function(a,b){var c=this.lookupMatches(this.currentHtmlChecking,this.getCurrentText(),b);if(e.isEmpty(c))throw"Selected flagged content is modified.";return this.scrollAndSelect(c),c},a.prototype.replaceSelection=function(a){var b=this.getEditorDocument(),c=rangy.getSelection(b),d=c.getRangeAt(0);a+='<span id="__caret">_</span>',d.deleteContents();var e=d.createContextualFragment(a);d.insertNode(e);var f=b.getElementById("__caret");d=rangy.createRange(),d.setStartBefore(f),d.setEndBefore(f),rangy.getSelection().setSingleRange(d),f.parentNode.removeChild(f)},a.prototype.replaceRanges=function(a,b){try{var c=this.selectMatches(a,b);this.scrollAndSelect(c);var d=e.map(c,"replacement").join("");this.replaceSelection(d),this.selectText(c[0].foundOffset,d.length)}catch(f){return void console.log(f)}},a}();b.ContentEditableAdapter=f}(c=b.adapter||(b.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(b){var c;!function(b){"use strict";var c=a.plugins.lookup.diffbased.lookupMatches,d=acrolinxLibs._,e=function(){function a(a){if(this.lookupMatches=c,a instanceof Element)this.element=a;else{var b=a;this.element=document.getElementById(b.editorId),b.lookupMatches&&(this.lookupMatches=b.lookupMatches)}}return a.prototype.getHTML=function(){return acrolinxLibs.$(this.element).val()},a.prototype.getEditorDocument=function(){try{return this.element.ownerDocument}catch(a){throw a}},a.prototype.getCurrentText=function(){try{return this.getHTML()}catch(a){throw a}},a.prototype.extractHTMLForCheck=function(){return this.html=this.getHTML(),this.currentHtmlChecking=this.html,{html:this.html}},a.prototype.registerCheckResult=function(a){return[]},a.prototype.registerCheckCall=function(a){},a.prototype.selectText=function(a,b){var c=this.getEditorDocument(),d=rangy.getSelection(c),e=rangy.createRange(c);return e.setStart(this.element,0),e.moveStart("character",a),e.moveEnd("character",b),d.setSingleRange(e),e},a.prototype.scrollIntoView2=function(a){var b=a.getRangeAt(0),c=b.cloneRange();c.collapse();var d=document.createElement("span");c.startContainer.parentNode.insertBefore(d,c.startContainer),d.scrollIntoView(),d.remove()},a.prototype.scrollAndSelect=function(a){var b,c,d=acrolinxLibs.$;b=a[0].foundOffset,c=a[0].flagLength,d(this.element).focus(),d(this.element).setSelection(b,b+c),d(this.element)[0].scrollIntoView();var e=d("#wp-content-editor-container");e.length>0&&window.scrollBy(0,-50)},a.prototype.selectRanges=function(a,b){this.selectMatches(a,b)},a.prototype.selectMatches=function(a,b){var c=this.lookupMatches(this.currentHtmlChecking,this.getCurrentText(),b);if(d.isEmpty(c))throw"Selected flagged content is modified.";return this.scrollAndSelect(c),c},a.prototype.replaceSelection=function(a){acrolinxLibs.$(this.element).replaceSelectedText(a,"select")},a.prototype.replaceRanges=function(a,b){try{var c=this.selectMatches(a,b);this.scrollAndSelect(c);var e=d.map(c,"replacement").join("");this.replaceSelection(e)}catch(f){return void console.log(f)}},a}();b.InputAdapter=e}(c=b.adapter||(b.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){"use strict";var b=function(){function a(a){this.config=a,this.adapters=[]}return a.prototype.addSingleAdapter=function(a,b,c){void 0===b&&(b="div"),void 0===c&&(c="acrolinx_integration"+this.adapters.length),this.adapters.push({id:c,adapter:a,wrapper:b})},a.prototype.getWrapperTag=function(a){var b=a.split(" ")[0];return b},a.prototype.extractHTMLForCheck=function(){for(var a=acrolinxLibs.Q,b=a.defer(),c=[],d=0;d<this.adapters.length;d++){var e=this.adapters[d];c.push(e.adapter.extractHTMLForCheck())}return a.all(c).then(acrolinxLibs._.bind(function(a){for(var c="",d=0;d<this.adapters.length;d++){var e=this.adapters[d],f=this.getWrapperTag(e.wrapper),g="<"+e.wrapper+' id="'+e.id+'">',h=a[d].html,i=g+h+"</"+f+">";e.start=c.length+g.length,e.end=c.length+g.length+h.length,c+=i}this.html=c,console.log(this.html),b.resolve({html:this.html})},this)),b.promise},a.prototype.registerCheckCall=function(a){},a.prototype.registerCheckResult=function(a){return this.checkResult=a,this.adapters.forEach(function(b){b.adapter.registerCheckResult(a)}),[]},a.prototype.selectRanges=function(a,b){var c=this.remapMatches(b);for(var d in c)c[d].adapter.selectRanges(a,c[d].matches)},a.prototype.remapMatches=function(a){for(var b={},c=0;c<a.length;c++){var d=acrolinxLibs._.clone(a[c]);d.range=acrolinxLibs._.clone(a[c].range);var e=this.getAdapterForMatch(d);b.hasOwnProperty(e.id)||(b[e.id]={matches:[],adapter:e.adapter}),d.range[0]-=e.start,d.range[1]-=e.start,b[e.id].matches.push(d)}return b},a.prototype.getAdapterForMatch=function(a){for(var b=0;b<this.adapters.length;b++){var c=this.adapters[b];if(a.range[0]>=c.start&&a.range[1]<=c.end)return c}return null},a.prototype.replaceRanges=function(a,b){var c=this.remapMatches(b);for(var d in c)c[d].adapter.replaceRanges(a,c[d].matches)},a}();a.MultiEditorAdapter=b}(b=a.adapter||(a.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(b){var c;!function(b){"use strict";var c=a.plugins.lookup.diffbased.lookupMatches,d=acrolinxLibs._,e=function(){function a(a){this.lookupMatches=c,this.editorId=a.editorId,this.editor=null,a.lookupMatches&&(this.lookupMatches=a.lookupMatches)}return a.prototype.getEditor=function(){return null===this.editor&&(this.editor=tinymce.get(this.editorId)),this.editor},a.prototype.getHTML=function(){return this.getEditor().getContent()},a.prototype.getEditorDocument=function(){try{return this.getEditor().contentDocument}catch(a){throw a}},a.prototype.getCurrentText=function(){try{return rangy.innerText(this.getEditorDocument())}catch(a){throw a}},a.prototype.selectText=function(a,b){var c=this.getEditorDocument(),d=rangy.getSelection(c),e=rangy.createRange(c);return e.moveStart("character",a),e.moveEnd("character",b),d.setSingleRange(e),e},a.prototype.scrollIntoView2=function(a){var b=a.getRng(),c=b.cloneRange();c.collapse();var d=document.createElement("span");c.startContainer.parentNode.insertBefore(d,c.startContainer),d.scrollIntoView(),d.remove()},a.prototype.scrollAndSelect=function(a){var b,c,d,e,f,b=a[0].foundOffset;if(c=a[0].flagLength,e=this.selectText(b,c),d=this.getEditor().selection)try{this.scrollIntoView2(d);var g=acrolinxLibs.$("#wp-content-editor-container");g.length>0&&g.get(0).scrollIntoView()}catch(h){console.log("Scrolling Error!")}f=this.selectText(b,c)},a.prototype.extractHTMLForCheck=function(){return this.html=this.getHTML(),this.currentHtmlChecking=this.html,{html:this.html}},a.prototype.registerCheckCall=function(a){},a.prototype.registerCheckResult=function(a){return this.isCheckingNow=!1,this.currentHtmlChecking=this.html,this.prevCheckedHtml=this.currentHtmlChecking,[]},a.prototype.selectRanges=function(a,b){this.selectMatches(a,b)},a.prototype.selectMatches=function(a,b){var c=this.lookupMatches(this.currentHtmlChecking,this.getCurrentText(),b);if(d.isEmpty(c))throw"Selected flagged content is modified.";return this.scrollAndSelect(c),c},a.prototype.replaceRanges=function(a,b){var c=1;try{var e=this.selectMatches(a,b),f=e[0].foundOffset+e[0].flagLength-1<this.getCurrentText().length;f&&(e[0].foundOffset+=c,e[0].flagLength-=c),this.scrollAndSelect(e);var g=d.map(e,"replacement").join("");this.editor.selection.setContent(g),f&&(c>0&&(this.selectText(e[0].foundOffset-c,c),rangy.getSelection(this.getEditorDocument()).nativeSelection.deleteFromDocument()),e[0].foundOffset-=c,e[0].flagLength+=c),this.selectText(e[0].foundOffset,g.length)}catch(h){throw console.log(h),h}},a}();b.TinyMCEAdapter=e}(c=b.adapter||(b.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){"use strict";function b(a){var b=/\w/g;return!b.test(a)}function c(a){var b=acrolinxLibs.$("<div/>").html(a);return b.text().replace(/\t+/g,"")}function d(a){return a.replace(/([\".*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function e(a,b){var c=a[0].textContent,d="\\b";return f(a,b)===!0&&(c=d+c+d),c}function f(a,c){var d,e,f,i,j,k,l=a[a.length-1].range[1];return e=h(l,l+1,c),i=a[0].textContent.split(/\\s+/),j=i[0],f=j.substr(0,1),k=j,i.length>1&&(k=i[1]),d=k.substr(k.length-1,1),k.indexOf("&")>-1&&k.indexOf(";")>-1&&k.indexOf(";")>k.indexOf("&")?!1:j.indexOf("&")>-1&&j.indexOf(";")>-1&&j.indexOf(";")>j.indexOf("&")?!1:g(f)&&g(d)&&g(e)&&45!==d.charCodeAt(0)&&!b(a[0].htmlContent)?!0:!1}function g(a){return a.charCodeAt(0)>=48&&a.charCodeAt(0)<=90||a.charCodeAt(0)>=97&&a.charCodeAt(0)<=126?!0:!1}function h(a,b,c){return c.substr(a,b-a)}function i(a,b){var f,g,i,j,k,l=a[0].range[0],m=a[a.length-1].range[1];return g=h(0,l,b),i=c(g),a[0].textOffset=i.length,0===a[0].textOffset&&(j=/<([a-zA-Z][a-zA-Z0-9]*)\b[^>]*/gm,null!==(k=j.exec(g))&&(l=a[0].textOffset+k.input.length)),a[0].htmlContent=h(l,m,b),f=c(a[0].htmlContent),f=d(f),a[0].textContent=f,a[0].searchPattern=e(a,b),a}function j(a,b){var c=-1,d=b[0].textOffset;if(a.length>0){c=0;for(var e=Math.abs(a[c]-d),f=0;f<a.length;f++)Math.abs(a[f]-d)<e&&(c=f,e=Math.abs(a[c]-d))}return c}function k(a,b){var c,d,e=[];d=new RegExp(b,"gm");for(var f=null;null!==(c=d.exec(a));){var g=c.index;if(f===g)break;f=g,e.push(g)}return e}function l(a,b,c){var d=i(m.cloneDeep(c),a),e=k(b,d[0].searchPattern),f=j(e,d),g=e[f];return g>=0?(d[0].foundOffset=g,d[0].content.length>=d[0].range[1]-d[0].range[0]?d[0].textContent=d[0].textContent.replace(/\\/g,""):d[0].textContent=d[0].textContent.replace(/\\\\/g,"\\"),d[0].flagLength=d[0].textContent.length-1,console.log(JSON.stringify(d)),d):[]}var m=acrolinxLibs._;a.lookupMatches=l}(b=a.old||(a.old={}))}(b=a.lookup||(a.lookup={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){"use strict";function b(a,b){function d(){function b(){j.acrolinxSidebar.init(g.assign({},{showServerSelector:!0,clientComponents:c},a))}console.log("Install acrolinxPlugin in sidebar."),j.acrolinxPlugin={requestInit:function(){console.log("requestInit"),b()},onInitFinished:function(a){console.log("onInitFinished: ",a),a.error&&window.alert(a.error.message)},configure:function(a){console.log("configure: ",a)},requestGlobalCheckSync:function(a,b,c){if(a.hasOwnProperty("error"))window.alert(a.error);else{var d=j.acrolinxSidebar.checkGlobal(a.html,{inputFormat:b||"HTML",requestDescription:{documentReference:c||"filename.html"}});k.registerCheckCall(d)}},requestGlobalCheck:function(){console.log("requestGlobalCheck");var a=k.extractHTMLForCheck(),b=k.getFormat?k.getFormat():null,c=k.getDocumentReference?k.getDocumentReference():null;if(void 0!==a.then){var d=this;a.then(function(a){d.requestGlobalCheckSync(a,b,c)})}else this.requestGlobalCheckSync(a,b,c)},onCheckResult:function(a){return k.registerCheckResult(a)},selectRanges:function(a,b){console.log("selectRanges: ",a,b);try{k.selectRanges(a,b)}catch(c){console.log(c),j.acrolinxSidebar.invalidateRanges(b.map(function(b){return{checkId:a,range:b.range}}))}},replaceRanges:function(a,b){console.log("replaceRanges: ",a,b);try{k.replaceRanges(a,b)}catch(c){console.log(c),j.acrolinxSidebar.invalidateRanges(b.map(function(b){return{checkId:a,range:b.range}}))}},getRangesOrder:function(a){return console.log("getRangesOrder: ",a),[]},download:function(a){console.log("download: ",a.url,a),window.open(a.url)},verifyRanges:function(a){return console.log("verifyRanges: ",a),[]},disposeCheck:function(a){console.log("disposeCheck: ",a)}}}function e(){var b;return b=void 0!==a.sidebarUrl?a.sidebarUrl:"https://acrolinx-sidebar-classic.s3.amazonaws.com/v14/prod/",acrolinxLibs.$.ajax({url:b+"index.html"}).then(function(a){var c=a.replace(/src="/g,'src="'+b).replace(/href="/g,'href="'+b);j.document.open(),j.document.write(c),j.document.close(),d()})}var f=acrolinxLibs.$,g=acrolinxLibs._,h=f("#"+a.sidebarContainerId),i=f("<iframe></iframe>");h.append(i);var j=i.get(0).contentWindow,k=b;e()}var c=[{id:"com.acrolinx.sidebarexample",name:"Acrolinx Sidebar Example Client",version:"1.2.3.999",category:"MAIN"}],d=function(){function a(a){this.config=a}return a.prototype.registerAdapter=function(a){this.adapter=a},a.prototype.init=function(){b(this.config,this.adapter)},a}();a.AcrolinxPlugin=d}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));
//# sourceMappingURL=acrolinx-sidebar-integration.min.js.map