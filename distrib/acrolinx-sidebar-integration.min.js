var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},acrolinxLibs;!function(a){"use strict";var b=window,c=b.acrolinxLibs||{};a.Q=c.Q||b.Q,a._=c._||b._}(acrolinxLibs||(acrolinxLibs={}));var acrolinx;!function(a){var b;!function(a){"use strict";a.SoftwareComponentCategory={MAIN:"MAIN",DEFAULT:"DEFAULT",DETAIL:"DETAIL"},a.ErrorCodes={checkIsAlreadyRunning:"checkIsAlreadyRunning",userIsNotLoggedIn:"userIsNotLoggedIn",sidebarNotReadyForCheck:"sidebarNotReadyForCheck",checkCanceledByUser:"checkCanceledByUser",base64EncodedGzippedUnsupported:"base64EncodedGzippedUnsupported"}}(b=a.sidebar||(a.sidebar={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){function b(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];d&&console.log.apply(console,[a].concat(b))}function c(){d=!0}var d=!1;a.log=b,a.enableLogging=c}(b=a.utils||(a.utils={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){"use strict";function c(a){var b=[],c=0,d=0;return a.forEach(function(a){var e=a[0],f=a[1];switch(e){case DIFF_EQUAL:c+=f.length;break;case DIFF_DELETE:c+=f.length,d-=f.length;break;case DIFF_INSERT:d+=f.length;break;default:throw new Error("Illegal Diff Action: "+e)}b.push({oldPosition:c,diffOffset:d})}),b}function d(a){var b=document.createElement("div");return b.innerHTML=a,b.textContent}function e(a){var b=/(<([^>]+)>|&.*?;)/gi,c=[],e=0,f=a.replace(b,function(a,b,f,g){var h=j.startsWith(a,"&")?d(a):"";return e-=a.length-h.length,c.push({oldPosition:g+a.length,diffOffset:e}),h});return[f,c]}function f(a,b){if(0===a.length)return 0;var c=j.sortedIndexBy(a,{diffOffset:0,oldPosition:b+.1},function(a){return a.oldPosition});return c>0?a[c-1].diffOffset:0}function g(a,b){return!1}function h(a,b){return a.slice(b.range[0],b.range[1])}function i(a,b,d,i){if(void 0===i&&(i="HTML"),j.isEmpty(d))return[];var m="HTML"===i?e(a):[a,[]],n=m[0],o=m[1],p=l.diff_main(n,b),q=c(p),r=d.map(function(a){var b=a.range[0]+f(o,a.range[0]),c=a.range[1]+f(o,a.range[1]),d=b+f(q,b),e=c-1,h=e+f(q,e)+1,i=g(q,a.range[0])||g(q,a.range[1]);return{originalMatch:a,range:[d,h],hasModifiedWordBorders:i}}),s=j.some(r,function(a){return h(b,a)!==a.originalMatch.content||a.hasModifiedWordBorders});return k("checkedDocument",a),k("cleanedCheckedDocument",n),k("cleanedCheckedDocumentCodes",n.split("").map(function(a){return a.charCodeAt(0)})),k("currentDocument",b),k("currentDocumentCodes",b.split("").map(function(a){return a.charCodeAt(0)})),k("matches",d),k("diffs",p),k("alignedMatches",r),k("alignedMatchesContent",r.map(function(a){return h(b,a)})),s?[]:r}var j=acrolinxLibs._,k=a.plugins.utils.log,l=new diff_match_patch;b.createOffsetMappingArray=c,b.replaceTags=e,b.findNewOffset=f,b.lookupMatches=i}(c=b.diffbased||(b.diffbased={}))}(c=b.lookup||(b.lookup={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){function b(a,b){var c=Date.now(),d=b();return console.log('Duration of "'+a+':"',Date.now()-c),d}function c(a){return a[a.length-1].range[1]-a[0].range[0]}function d(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onload=function(){if(!(c.status>=200&&c.status<400))throw new Error("Error while loading "+a+".");b(c.responseText)},c.onerror=function(){throw new Error("Error while loading "+a+".")},c.send()}a.logTime=b,a.getCompleteFlagLength=c,a.fetch=d}(b=a.utils||(a.utils={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(b){var c;!function(c){"use strict";var d=a.plugins.lookup.diffbased.lookupMatches,e=acrolinxLibs._,f=a.plugins.utils.getCompleteFlagLength,g=function(){function a(a){this.editorId=a.editorId}return a.prototype.getEditorElement=function(){return this.getEditorDocument().querySelector("body")},a.prototype.registerCheckCall=function(a){},a.prototype.registerCheckResult=function(a){this.isCheckingNow=!1,this.currentHtmlChecking=this.html,this.prevCheckedHtml=this.currentHtmlChecking},a.prototype.extractHTMLForCheck=function(){return this.html=this.getHTML(),this.currentHtmlChecking=this.html,{html:this.html}},a.prototype.scrollIntoView=function(a){var b=a.getRangeAt(0),c=b.cloneRange();c.collapse(!1);var d=document.createElement("span");c.insertNode(d),d.scrollIntoView(),d.remove()},a.prototype.scrollToCurrentSelection=function(){var a=this.getEditorDocument().getSelection();if(a)try{this.scrollIntoView(a)}catch(b){console.log("Scrolling Error: ",b)}},a.prototype.selectRanges=function(a,b){this.selectMatches(a,b),this.scrollToCurrentSelection()},a.prototype.selectMatches=function(a,b){var c=this.getTextDomMapping(),f=d(this.currentHtmlChecking,c.text,b);if(e.isEmpty(f))throw new Error("Selected flagged content is modified.");return this.selectAlignedMatches(f,c),[f,c]},a.prototype.selectAlignedMatches=function(a,b){var c=a[0].range[0],d=f(a);this.selectText(c,d,b)},a.prototype.selectText=function(a,b,c){if(c.text){var d=this.getEditorDocument(),e=d.getSelection();e.removeAllRanges(),e.addRange(this.createRange(a,b,c))}},a.prototype.createRange=function(a,c,d){var e=this.getEditorDocument(),f=e.createRange(),g=d.domPositions[a],h=b.utils.getEndDomPos(a+c,d.domPositions);return f.setStart(g.node,g.offset),f.setEnd(h.node,h.offset),f},a.prototype.replaceAlignedMatches=function(a){for(var b=this.getEditorDocument(),c=e.clone(a).reverse(),d=0,f=c;d<f.length;d++){var g=f[d],h=this.getTextDomMapping(),i=g.range[1]-g.range[0];if(i>1){var j=this.createRange(g.range[0]+1,i-1,h),k=this.createRange(g.range[0],1,h);j.deleteContents(),k.deleteContents(),k.insertNode(b.createTextNode(g.originalMatch.replacement))}else{var l=this.createRange(g.range[0],i,h);l.deleteContents(),l.insertNode(b.createTextNode(g.originalMatch.replacement))}}},a.prototype.replaceRanges=function(a,b){var c=this.selectMatches(a,b)[0],d=c.map(function(a){return a.originalMatch.replacement}).join("");this.replaceAlignedMatches(c),this.selectText(c[0].range[0],d.length,this.getTextDomMapping()),this.scrollToCurrentSelection()},a.prototype.getTextDomMapping=function(){return b.utils.extractTextDomMapping(this.getEditorElement())},a}();c.AbstractRichtextEditorAdapter=g}(c=b.adapter||(b.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){"use strict";var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.getEditor=function(){return CKEDITOR.instances[this.editorId]},b.prototype.getEditorDocument=function(){return this.getEditor().document.$},b.prototype.getHTML=function(){return this.getEditor().getData()},b.prototype.extractHTMLForCheck=function(){if(this.html=this.getHTML(),this.currentHtmlChecking=this.html,this.isInWysiwygMode())""===this.html&&(this.html="<span> </span>");else{if(!this.isCheckingNow)return{error:"Action is not permitted in Source mode."};this.isCheckingNow=!1}return{html:this.html}},b.prototype.selectRanges=function(b,c){this.isInWysiwygMode()?a.prototype.selectRanges.call(this,b,c):window.alert("Action is not permitted in Source mode.")},b.prototype.replaceRanges=function(b,c){this.isInWysiwygMode()?a.prototype.replaceRanges.call(this,b,c):window.alert("Action is not permitted in Source mode.")},b.prototype.isInWysiwygMode=function(){return"wysiwyg"===this.getEditor().mode},b}(a.AbstractRichtextEditorAdapter);a.CKEditorAdapter=b}(b=a.adapter||(a.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){"use strict";var b=function(a){function b(b){a.call(this,b),this.element=document.getElementById(b.editorId)}return __extends(b,a),b.prototype.getEditorElement=function(){return this.element},b.prototype.getHTML=function(){return this.element.innerHTML},b.prototype.getEditorDocument=function(){return this.element.ownerDocument},b}(a.AbstractRichtextEditorAdapter);a.ContentEditableAdapter=b}(b=a.adapter||(a.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(b){var c;!function(b){"use strict";var c=a.plugins.lookup.diffbased.lookupMatches,d=acrolinxLibs._,e=a.plugins.utils.getCompleteFlagLength,f=function(){function a(a){if(a instanceof Element)this.element=a;else{var b=a;this.element=document.getElementById(b.editorId)}}return a.prototype.getHTML=function(){return this.element.value},a.prototype.getCurrentText=function(){return this.getHTML()},a.prototype.getFormat=function(){return"TEXT"},a.prototype.extractHTMLForCheck=function(){return this.html=this.getHTML(),this.currentHtmlChecking=this.html,{html:this.html}},a.prototype.registerCheckResult=function(a){},a.prototype.registerCheckCall=function(a){},a.prototype.scrollAndSelect=function(a){var b=a[0].range[0],c=e(a),d=this.element;if(d.clientHeight<d.scrollHeight){var f=this.element.value;d.value=f.slice(0,b),d.focus(),d.scrollTop=1e9;var g=d.scrollTop;d.value=f,g>0&&(d.scrollTop=g+d.clientHeight/2)}d.setSelectionRange(b,b+c),d.focus(),d.scrollIntoView()},a.prototype.selectRanges=function(a,b){this.selectMatches(a,b)},a.prototype.selectMatches=function(a,b){var e=c(this.currentHtmlChecking,this.getCurrentText(),b,"TEXT");if(d.isEmpty(e))throw"Selected flagged content is modified.";return this.scrollAndSelect(e),e},a.prototype.replaceAlignedMatches=function(a){for(var b=d.clone(a).reverse(),c=this.element,e=c.value,f=0,g=b;f<g.length;f++){var h=g[f];e=e.slice(0,h.range[0])+h.originalMatch.replacement+e.slice(h.range[1])}c.value=e},a.prototype.replaceRanges=function(a,b){var c=this.selectMatches(a,b);this.scrollAndSelect(c),this.replaceAlignedMatches(c);var d=c[0].range[0],e=c.map(function(a){return a.originalMatch.replacement}).join("");this.element.setSelectionRange(d,d+e.length)},a}();b.InputAdapter=f}(c=b.adapter||(b.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){"use strict";var b=acrolinxLibs._,c=function(){function a(a){this.config=a,this.adapters=[]}return a.prototype.addSingleAdapter=function(a,b,c){void 0===b&&(b="div"),void 0===c&&(c="acrolinx_integration"+this.adapters.length),this.adapters.push({id:c,adapter:a,wrapper:b})},a.prototype.getWrapperTag=function(a){return a.split(" ")[0]},a.prototype.extractHTMLForCheck=function(){var a=this,b=acrolinxLibs.Q,c=b.defer(),d=this.adapters.map(function(a){return a.adapter.extractHTMLForCheck()});return b.all(d).then(function(b){for(var d="",e=0;e<a.adapters.length;e++){var f=a.adapters[e],g=a.getWrapperTag(f.wrapper),h="<"+f.wrapper+' id="'+f.id+'">',i=b[e].html,j=h+i+"</"+g+">";f.start=d.length+h.length,f.end=d.length+h.length+i.length,d+=j}c.resolve({html:d})}),c.promise},a.prototype.registerCheckCall=function(a){},a.prototype.registerCheckResult=function(a){this.checkResult=a,this.adapters.forEach(function(b){b.adapter.registerCheckResult(a)})},a.prototype.selectRanges=function(a,b){var c=this.remapMatches(b);for(var d in c)c[d].adapter.selectRanges(a,c[d].matches)},a.prototype.remapMatches=function(a){for(var c={},d=0,e=a;d<e.length;d++){var f=e[d],g=this.getAdapterForMatch(f);c.hasOwnProperty(g.id)||(c[g.id]={matches:[],adapter:g.adapter});var h=b.clone(f);h.range=[f.range[0]-g.start,f.range[1]-g.start],c[g.id].matches.push(h)}return c},a.prototype.getAdapterForMatch=function(a){return b.find(this.adapters,function(b){return a.range[0]>=b.start&&a.range[1]<=b.end})},a.prototype.replaceRanges=function(a,b){var c=this.remapMatches(b);for(var d in c)c[d].adapter.replaceRanges(a,c[d].matches)},a}();a.MultiEditorAdapter=c}(b=a.adapter||(a.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){"use strict";var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.getEditor=function(){return tinymce.get(this.editorId)},b.prototype.getHTML=function(){return this.getEditor().getContent()},b.prototype.getEditorDocument=function(){return this.getEditor().getDoc()},b.prototype.scrollToCurrentSelection=function(){var a=this.getEditorDocument().getSelection();if(a)try{var b=a.getRangeAt(0),c=b.startContainer,d=b.startOffset,e=b.endContainer,f=b.endOffset;a.collapseToStart(),this.getEditor().insertContent("");var g=this.getEditorDocument().createRange();g.setStart(c,d),g.setEnd(e,f),a.removeAllRanges(),a.addRange(g)}catch(h){console.log("Scrolling Error: ",h)}},b}(a.AbstractRichtextEditorAdapter);a.TinyMCEAdapter=b}(b=a.adapter||(a.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){"use strict";var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.getEditor=function(){return tinymce.get(this.editorId)},b.prototype.getHTML=function(){return this.getEditor().getContent()},b.prototype.getEditorDocument=function(){return this.getEditor().getDoc()},b.prototype.scrollToCurrentSelection=function(){var b=this.getEditor().getBody(),c=this.getEditor().getContainer().clientWidth,d=b.scrollWidth,e=c>d;e?a.prototype.scrollToCurrentSelection.call(this):this.scrollToCurrentSelectionWithGlobalScrollbar()},b.prototype.scrollToCurrentSelectionWithGlobalScrollbar=function(){var a=this.getEditorDocument().getSelection();if(a)try{this.scrollIntoViewWithGlobalScrollbar(a)}catch(b){console.log("Scrolling Error: ",b)}},b.prototype.scrollIntoViewWithGlobalScrollbar=function(a){var b=a.getRangeAt(0),c=b.cloneRange();c.collapse(!1);var d=document.createElement("span");c.insertNode(d);var e=d.getClientRects()[0].top;window.scrollTo(0,e),d.remove()},b}(a.TinyMCEAdapter);a.TinyMCEWordpressAdapter=b}(b=a.adapter||(a.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){"use strict";function b(a){return void 0!==a.then}function c(c,f){function g(){function a(){k.acrolinxSidebar.init(d.assign({},{showServerSelector:!0,clientComponents:e},c))}function f(a,b,c){if(a.hasOwnProperty("error"))window.alert(a.error);else{var d=k.acrolinxSidebar.checkGlobal(a.html,{inputFormat:b||"HTML",requestDescription:{documentReference:c||"filename.html"}});l.registerCheckCall(d)}}var g={requestInit:function(){console.log("requestInit"),a()},onInitFinished:function(a){console.log("onInitFinished: ",a),a.error&&window.alert(a.error.message)},configure:function(a){console.log("configure: ",a)},requestGlobalCheck:function(){console.log("requestGlobalCheck");var a=l.extractHTMLForCheck(),c=l.getFormat?l.getFormat():null,d=l.getDocumentReference?l.getDocumentReference():null;b(a)?a.then(function(a){f(a,c,d)}):f(a,c,d)},onCheckResult:function(a){return l.registerCheckResult(a)},selectRanges:function(a,b){console.log("selectRanges: ",a,b);try{l.selectRanges(a,b)}catch(c){console.log(c),k.acrolinxSidebar.invalidateRanges(b.map(function(b){return{checkId:a,range:b.range}}))}},replaceRanges:function(a,b){console.log("replaceRanges: ",a,b);try{l.replaceRanges(a,b)}catch(c){console.log(c),k.acrolinxSidebar.invalidateRanges(b.map(function(b){return{checkId:a,range:b.range}}))}},download:function(a){console.log("download: ",a.url,a),window.open(a.url)},openWindow:function(a){var b=a.url;window.open(b)}};console.log("Install acrolinxPlugin in sidebar."),k.acrolinxPlugin=g}function h(){var b=c.sidebarUrl||"https://acrolinx-sidebar-classic.s3.amazonaws.com/v14/prod/";a.utils.fetch(b+"index.html",function(a){var c=a.replace(/src="/g,'src="'+b).replace(/href="/g,'href="'+b);k.document.open(),k.document.write(c),k.document.close(),g()})}var i=document.getElementById(c.sidebarContainerId),j=document.createElement("iframe");i.appendChild(j);var k=j.contentWindow,l=f;h()}var d=acrolinxLibs._,e=[{id:"com.acrolinx.sidebarexample",name:"Acrolinx Sidebar Example Client",version:"1.2.3.999",category:"MAIN"}],f=function(){function a(a){this.config=a}return a.prototype.registerAdapter=function(a){this.adapter=a},a.prototype.init=function(){c(this.config,this.adapter)},a}();a.AcrolinxPlugin=f}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){function b(a,b){return{text:a,domPositions:b}}function c(a){return{text:a.map(function(a){return a.text}).join(""),domPositions:g.flatten(a.map(function(a){return a.domPositions}))}}function d(a,b){return{node:a,offset:b}}function e(a){return c(g.map(a.childNodes,function(a){switch(a.nodeType){case Node.ELEMENT_NODE:return e(a);case Node.TEXT_NODE:default:return b(a.textContent,g.times(a.textContent.length,function(b){return d(a,b)}))}}))}function f(a,b){var c=b[Math.max(Math.min(a,b.length)-1,0)];return{node:c.node,offset:c.offset+1}}var g=acrolinxLibs._;a.textMapping=b,a.concatTextMappings=c,a.domPosition=d,a.extractTextDomMapping=e,a.getEndDomPos=f}(b=a.utils||(a.utils={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));
//# sourceMappingURL=acrolinx-sidebar-integration.min.js.map