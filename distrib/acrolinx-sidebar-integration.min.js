var acrolinxLibs;!function(a){"use strict";var b=window.acrolinxLibs||{};a.Q=b.Q||window.Q,a.$=b.$||window.$,a._=b._||window._}(acrolinxLibs||(acrolinxLibs={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){"use strict";function b(a){var b=/\w/g;return!b.test(a)}function c(a,b){a.deleteContents(),a.insertNode(a.createContextualFragment(b))}function d(a){var b=acrolinxLibs.$("<div/>").html(a);return b.text().replace(/\t+/g,"")}function e(a){return a.replace(/([\".*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function f(a,b){var c=a[0].textContent,d="\\b";return g(a,b)===!0&&(c=d+c+d),c}function g(a,c){var d,e,f,g,j,k,l=a[a.length-1].range[1];return e=i(l,l+1,c),g=a[0].textContent.split(/\\s+/),j=g[0],f=j.substr(0,1),k=j,g.length>1&&(k=g[1]),d=k.substr(k.length-1,1),k.indexOf("&")>-1&&k.indexOf(";")>-1&&k.indexOf(";")>k.indexOf("&")?!1:j.indexOf("&")>-1&&j.indexOf(";")>-1&&j.indexOf(";")>j.indexOf("&")?!1:h(f)&&h(d)&&h(e)&&45!==d.charCodeAt(0)&&!b(a[0].htmlContent)?!0:!1}function h(a){return a.charCodeAt(0)>=48&&a.charCodeAt(0)<=90||a.charCodeAt(0)>=97&&a.charCodeAt(0)<=126?!0:!1}function i(a,b,c){return c.substr(a,b-a)}function j(a,b){var c,g,h,j,k,l=a[0].range[0],m=a[a.length-1].range[1];return g=i(0,l,b),h=d(g),a[0].textOffset=h.length,0===a[0].textOffset&&(j=/<([a-zA-Z][a-zA-Z0-9]*)\b[^>]*/gm,null!==(k=j.exec(g))&&(l=a[0].textOffset+k.input.length)),a[0].htmlContent=i(l,m,b),c=d(a[0].htmlContent),c=e(c),a[0].textContent=c,a[0].searchPattern=f(a,b),a}function k(a,b){var c=-1,d=b[0].textOffset;if(a.length>0){c=0;for(var e=Math.abs(a[c]-d),f=0;f<a.length;f++)Math.abs(a[f]-d)<e&&(c=f,e=Math.abs(a[c]-d))}return c}function l(a,b){var c,d,e=[];d=new RegExp(b,"gm");for(var f=null;null!==(c=d.exec(a));){var g=c.index;if(f===g)break;f=g,e.push(g)}return e}a.isFlagContainsOnlySpecialChar=b,a.replaceRangeContent=c,a.getTextContent=d,a.escapeRegExp=e,a.createSearchPattern=f,a.shouldApplyWordBoundary=g,a.isAlphaNumeral=h,a.getFlagContents=i,a.addPropertiesToMatches=j,a.findBestMatchOffset=k,a.findAllFlagOffsets=l}(b=a.selection||(a.selection={}))}(b=a.utils||(a.utils={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(b){var c;!function(b){"use strict";var c=a.plugins.utils.selection,d=function(){function a(a){this.config=a,this.editorId=a.editorId,this.editor=null}return a.prototype.getEditor=function(){return null===this.editor&&CKEDITOR.instances.hasOwnProperty(this.editorId)&&(this.editor=CKEDITOR.instances[this.editorId]),this.editor},a.prototype.getEditorDocument=function(){try{return this.getEditor().document.$}catch(a){throw a}},a.prototype.getEditableElement=function(){return this.editor.editable().$},a.prototype.getCurrentText=function(){try{return rangy.innerText(this.getEditorDocument())}catch(a){throw a}},a.prototype.getHTML=function(){return this.getEditor().getData()},a.prototype.createRange=function(a,b){var c=this.getEditableElement(),d=rangy.createRange(this.getEditorDocument());return d.setStart(c,0),d.setEnd(c,0),d.moveStart("character",a),d.moveEnd("character",b),d},a.prototype.selectText=function(a,b){var c=this.createRange(a,b),d=rangy.getSelection(this.getEditorDocument());return d.setSingleRange(c),c},a.prototype.scrollAndSelect=function(a){var b,c,d,e,f,g,h;if(b=a[0].foundOffset,c=a[0].flagLength+1,f=this.selectText(b,c),d=this.getEditor().getSelection())try{d.scrollIntoView()}catch(i){}return h=this.getEditorDocument(),e=rangy.getSelection(h),g=rangy.createRange(h),g.setStart(f.startContainer,f.startOffset),g.setEnd(f.endContainer,f.endOffset),e.setSingleRange(g),g},a.prototype.extractHTMLForCheck=function(){if(this.html=this.getHTML(),this.currentHtmlChecking=this.html,"wysiwyg"===this.editor.mode)this.checkStartTime=Date.now(),""===this.html&&(this.html="<span> </span>");else{if(!this.isCheckingNow)return{error:"Action is not permitted in Source mode."};this.isCheckingNow=!1}return{html:this.html}},a.prototype.registerCheckCall=function(a){},a.prototype.registerCheckResult=function(a){return this.isCheckingNow=!1,this.currentHtmlChecking=this.html,this.prevCheckedHtml=this.currentHtmlChecking,[]},a.prototype.selectRanges=function(a,b){"wysiwyg"===this.editor.mode?this.selectMatches(a,b):window.alert("Action is not permitted in Source mode.")},a.prototype.selectMatches=function(a,b){var d,e,f,g=this.getCurrentText();if(b=c.addPropertiesToMatches(b,this.currentHtmlChecking),d=c.findAllFlagOffsets(g,b[0].searchPattern),e=c.findBestMatchOffset(d,b),f=d[e],b[0].foundOffset=f,b[0].content.length>=b[0].range[1]-b[0].range[0]?b[0].textContent=b[0].textContent.replace(/\\/g,""):b[0].textContent=b[0].textContent.replace(/\\\\/g,"\\"),b[0].flagLength=b[0].textContent.length-1,!(f>=0))throw"Selected flagged content is modified.";this.scrollAndSelect(b)},a.prototype.replaceRanges=function(a,b){var d,e,f=1;if("wysiwyg"===this.editor.mode){try{this.selectMatches(a,b),b[0].foundOffset+b[0].flagLength<this.getCurrentText().length&&(b[0].foundOffset+=f,b[0].flagLength-=f),e=this.scrollAndSelect(b)}catch(g){return void console.log(g)}d=acrolinxLibs._.map(b,"replacement").join(""),c.replaceRangeContent(e,d),b[0].foundOffset+b[0].flagLength<this.getCurrentText().length&&(f>0&&(this.selectText(b[0].foundOffset-f,f),rangy.getSelection(this.getEditorDocument()).nativeSelection.deleteFromDocument()),b[0].foundOffset-=f,b[0].flagLength+=f),this.selectText(b[0].foundOffset,d.length)}else window.alert("Action is not permitted in Source mode.")},a}();b.CKEditorAdapter=d}(c=b.adapter||(b.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(b){var c;!function(b){"use strict";var c=a.plugins.utils.selection,d=function(){function a(a){void 0!==a.editorId?this.element=document.getElementById(a.editorId):this.element=a}return a.prototype.getHTML=function(){return acrolinxLibs.$(this.element).val()},a.prototype.getEditorDocument=function(){try{return this.element.ownerDocument}catch(a){throw a}},a.prototype.getCurrentText=function(){try{return this.getHTML()}catch(a){throw a}},a.prototype.extractHTMLForCheck=function(){return this.html=this.getHTML(),this.currentHtmlChecking=this.html,{html:this.html}},a.prototype.registerCheckResult=function(a){return[]},a.prototype.registerCheckCall=function(a){},a.prototype.selectText=function(a,b){var c=this.getEditorDocument(),d=rangy.getSelection(c),e=rangy.createRange(c);return e.setStart(this.element,0),e.moveStart("character",a),e.moveEnd("character",b),d.setSingleRange(e),e},a.prototype.scrollIntoView2=function(a){var b=a.getRangeAt(0),c=b.cloneRange();c.collapse();var d=document.createElement("span");c.startContainer.parentNode.insertBefore(d,c.startContainer),d.scrollIntoView(),d.remove()},a.prototype.scrollAndSelect=function(a){var b,c,d=acrolinxLibs.$;b=a[0].foundOffset,c=a[0].flagLength+1,d(this.element).focus(),d(this.element).setSelection(b,b+c),d(this.element)[0].scrollIntoView();var e=d("#wp-content-editor-container");e.length>0&&window.scrollBy(0,-50)},a.prototype.selectRanges=function(a,b){this.selectMatches(a,b)},a.prototype.selectMatches=function(a,b){var d,e,f,g=this.getCurrentText();if(b=c.addPropertiesToMatches(b,this.currentHtmlChecking),d=c.findAllFlagOffsets(g,b[0].searchPattern),e=c.findBestMatchOffset(d,b),f=d[e],b[0].foundOffset=f,b[0].content.length>=b[0].range[1]-b[0].range[0]?b[0].textContent=b[0].textContent.replace(/\\/g,""):b[0].textContent=b[0].textContent.replace(/\\\\/g,"\\"),b[0].flagLength=b[0].textContent.length-1,!(f>=0))throw"Selected flagged content is modified.";this.scrollAndSelect(b)},a.prototype.replaceSelection=function(a){acrolinxLibs.$(this.element).replaceSelectedText(a,"select")},a.prototype.replaceRanges=function(a,b){var c,d=0;try{this.selectMatches(a,b),b[0].foundOffset+b[0].flagLength<this.getCurrentText().length&&(b[0].foundOffset+=d,b[0].flagLength-=d),this.scrollAndSelect(b)}catch(e){return void console.log(e)}c=acrolinxLibs._.map(b,"replacement").join(""),this.replaceSelection(c)},a}();b.InputAdapter=d}(c=b.adapter||(b.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){"use strict";var b=function(){function a(a){this.config=a,this.adapters=[]}return a.prototype.addSingleAdapter=function(a,b,c){void 0===b&&(b="div"),void 0===c&&(c="acrolinx_integration"+this.adapters.length),this.adapters.push({id:c,adapter:a,wrapper:b})},a.prototype.getWrapperTag=function(a){var b=a.split(" ")[0];return b},a.prototype.extractHTMLForCheck=function(){for(var a=acrolinxLibs.Q,b=a.defer(),c=[],d=0;d<this.adapters.length;d++){var e=this.adapters[d];c.push(e.adapter.extractHTMLForCheck())}return a.all(c).then(acrolinxLibs._.bind(function(a){for(var c="",d=0;d<this.adapters.length;d++){var e=this.adapters[d],f=this.getWrapperTag(e.wrapper),g="<"+e.wrapper+' id="'+e.id+'">',h=a[d].html,i=g+h+"</"+f+">";e.start=c.length+g.length,e.end=c.length+g.length+h.length,c+=i}this.html=c,console.log(this.html),b.resolve({html:this.html})},this)),b.promise},a.prototype.registerCheckCall=function(a){},a.prototype.registerCheckResult=function(a){return this.checkResult=a,this.adapters.forEach(function(b){b.adapter.registerCheckResult(a)}),[]},a.prototype.selectRanges=function(a,b){var c=this.remapMatches(b);for(var d in c)c[d].adapter.selectRanges(a,c[d].matches)},a.prototype.remapMatches=function(a){for(var b={},c=0;c<a.length;c++){var d=acrolinxLibs._.clone(a[c]);d.range=acrolinxLibs._.clone(a[c].range);var e=this.getAdapterForMatch(d);b.hasOwnProperty(e.id)||(b[e.id]={matches:[],adapter:e.adapter}),d.range[0]-=e.start,d.range[1]-=e.start,b[e.id].matches.push(d)}return b},a.prototype.getAdapterForMatch=function(a){for(var b=0;b<this.adapters.length;b++){var c=this.adapters[b];if(a.range[0]>=c.start&&a.range[1]<=c.end)return c}return null},a.prototype.replaceRanges=function(a,b){var c=this.remapMatches(b);for(var d in c)c[d].adapter.replaceRanges(a,c[d].matches)},a}();a.MultiEditorAdapter=b}(b=a.adapter||(a.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){var b;!function(a){"use strict";var b=function(){function a(a){this.config=a}return a.prototype.selectText=function(a,b){var c=this.getEditorElement(),d=rangy.createRange();d.setStart(c,0),d.setEnd(c,0),d.moveStart("character",a),d.moveEnd("character",b);var e=rangy.getSelection();e.setSingleRange(d)},a.prototype.findRangesPositionInPlainText=function(a,b){var c=b.map(function(a){return a.content}).join(""),d=a.indexOf(c);return d>-1?{start:d,length:c.length}:null},a.prototype.getEditor=function(){return document.getElementById(this.config.editorId)},a.prototype.getEditorElement=function(){return this.getEditor()},a.prototype.getCurrentText=function(){return rangy.innerText(this.getEditorElement())},a.prototype.getHTML=function(){return this.getEditor().innerHTML},a.prototype.extractHTMLForCheck=function(){return{html:this.getHTML()}},a.prototype.registerCheckCall=function(a){},a.prototype.registerCheckResult=function(a){return[]},a.prototype.selectRanges=function(a,b){var c=this.findRangesPositionInPlainText(this.getCurrentText(),b);c?this.selectText(c.start,c.length):window.alert("Sorry, but I can't select this issue.")},a.prototype.replaceRanges=function(a,b){this.selectRanges(a,b);var c=b.map(function(a){return a.replacement}).join(""),d=rangy.getSelection(),e=d.getRangeAt(0);e.deleteContents();var f=e.createContextualFragment(c);e.insertNode(f)},a}();a.SimpleTextAdapter=b}(b=a.adapter||(a.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(b){var c;!function(b){"use strict";var c=a.plugins.utils.selection,d=function(){function a(a){this.config=a,this.editorId=a.editorId,this.editor=null}return a.prototype.getEditor=function(){return null===this.editor&&(this.editor=tinymce.get(this.editorId),console.log("tinymce found",this.editor)),this.editor},a.prototype.getHTML=function(){return this.getEditor().getContent()},a.prototype.getEditorDocument=function(){try{return this.editor.contentDocument}catch(a){throw a}},a.prototype.getCurrentText=function(){try{return rangy.innerText(this.getEditorDocument())}catch(a){throw a}},a.prototype.selectText=function(a,b){var c=this.getEditorDocument(),d=rangy.getSelection(c),e=rangy.createRange(c);return e.moveStart("character",a),e.moveEnd("character",b),d.setSingleRange(e),e},a.prototype.scrollIntoView2=function(a){var b=a.getRng(),c=b.cloneRange();c.collapse();var d=document.createElement("span");c.startContainer.parentNode.insertBefore(d,c.startContainer),d.scrollIntoView(),d.remove()},a.prototype.scrollAndSelect=function(a){var b,c,d,e,f,b=a[0].foundOffset;if(c=a[0].flagLength+1,e=this.selectText(b,c),d=this.getEditor().selection)try{this.scrollIntoView2(d);var g=acrolinxLibs.$("#wp-content-editor-container");g.length>0&&g.get(0).scrollIntoView()}catch(h){console.log("Scrolling Error!")}f=this.selectText(b,c)},a.prototype.extractHTMLForCheck=function(){return this.html=this.getHTML(),this.currentHtmlChecking=this.html,{html:this.html}},a.prototype.registerCheckCall=function(a){},a.prototype.registerCheckResult=function(a){return this.isCheckingNow=!1,this.currentHtmlChecking=this.html,this.prevCheckedHtml=this.currentHtmlChecking,[]},a.prototype.selectRanges=function(a,b){this.selectMatches(a,b)},a.prototype.selectMatches=function(a,b){var d,e,f,g=this.getCurrentText();if(b=c.addPropertiesToMatches(b,this.currentHtmlChecking),d=c.findAllFlagOffsets(g,b[0].searchPattern),e=c.findBestMatchOffset(d,b),f=d[e],b[0].foundOffset=f,b[0].content.length>=b[0].range[1]-b[0].range[0]?b[0].textContent=b[0].textContent.replace(/\\/g,""):b[0].textContent=b[0].textContent.replace(/\\\\/g,"\\"),b[0].flagLength=b[0].textContent.length-1,!(f>=0))throw"Selected flagged content is modified.";this.scrollAndSelect(b)},a.prototype.replaceRanges=function(a,b){var c,d=1;try{this.selectMatches(a,b),b[0].foundOffset+b[0].flagLength<this.getCurrentText().length&&(b[0].foundOffset+=d,b[0].flagLength-=d),this.scrollAndSelect(b)}catch(e){throw console.log(e),e}c=acrolinxLibs._.map(b,"replacement").join(""),this.editor.selection.setContent(c),b[0].foundOffset+b[0].flagLength<this.getCurrentText().length&&(d>0&&(this.selectText(b[0].foundOffset-d,d),rangy.getSelection(this.getEditorDocument()).nativeSelection.deleteFromDocument()),b[0].foundOffset-=d,b[0].flagLength+=d),this.selectText(b[0].foundOffset,c.length)},a}();b.TinyMCEAdapter=d}(c=b.adapter||(b.adapter={}))}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));var acrolinx;!function(a){var b;!function(a){"use strict";function b(a,b){function d(){function b(){i.acrolinxSidebar.init({clientComponents:a.clientComponents||c,clientSignature:a.clientSignature,showServerSelector:a.hasOwnProperty("showServerSelector")?a.showServerSelector:!0,enableSingleSignOn:a.hasOwnProperty("enableSingleSignOn")?a.enableSingleSignOn:!1,serverAddress:a.serverAddress,defaultCheckSettings:a.defaultCheckSettings})}console.log("Install acrolinxPlugin in sidebar."),i.acrolinxPlugin={requestInit:function(){console.log("requestInit"),b()},onInitFinished:function(a){console.log("onInitFinished: ",a),a.error&&window.alert(a.error.message)},configure:function(a){console.log("configure: ",a)},requestGlobalCheckSync:function(a,b,c){if(a.hasOwnProperty("error"))window.alert(a.error);else{var d=i.acrolinxSidebar.checkGlobal(a.html,{inputFormat:b||"HTML",requestDescription:{documentReference:c||"filename.html"}});j.registerCheckCall(d)}},requestGlobalCheck:function(){console.log("requestGlobalCheck");var a=j.extractHTMLForCheck(),b=j.getFormat?j.getFormat():null,c=j.getDocumentReference?j.getDocumentReference():null;if(void 0!==a.then){var d=this;a.then(function(a){d.requestGlobalCheckSync(a,b,c)})}else this.requestGlobalCheckSync(a,b,c)},onCheckResult:function(a){return j.registerCheckResult(a)},selectRanges:function(a,b){console.log("selectRanges: ",a,b);try{j.selectRanges(a,b)}catch(c){console.log(c),i.acrolinxSidebar.invalidateRanges(b.map(function(b){return{checkId:a,range:b.range}}))}},replaceRanges:function(a,b){console.log("replaceRanges: ",a,b);try{j.replaceRanges(a,b)}catch(c){console.log(c),i.acrolinxSidebar.invalidateRanges(b.map(function(b){return{checkId:a,range:b.range}}))}},getRangesOrder:function(a){return console.log("getRangesOrder: ",a),[]},download:function(a){console.log("download: ",a.url,a),window.open(a.url)},verifyRanges:function(a){return console.log("verifyRanges: ",a),[]},disposeCheck:function(a){console.log("disposeCheck: ",a)}}}function e(){var b;return b=void 0!==a.sidebarUrl?a.sidebarUrl:"https://acrolinx-sidebar-classic.s3.amazonaws.com/v14/prod/",acrolinxLibs.$.ajax({url:b+"index.html"}).then(function(a){var c=a.replace(/src="/g,'src="'+b).replace(/href="/g,'href="'+b);i.document.open(),i.document.write(c),i.document.close(),d()})}var f=acrolinxLibs.$,g=f("#"+a.sidebarContainerId),h=f("<iframe></iframe>");g.append(h);var i=h.get(0).contentWindow,j=b;e()}var c=[{id:"com.acrolinx.sidebarexample",name:"Acrolinx Sidebar Example Client",version:"1.2.3.999",category:"MAIN"}],d=function(){function a(a){this.config=a}return a.prototype.registerAdapter=function(a){this.adapter=a},a.prototype.init=function(){b(this.config,this.adapter)},a}();a.AcrolinxPlugin=d}(b=a.plugins||(a.plugins={}))}(acrolinx||(acrolinx={}));
//# sourceMappingURL=acrolinx-sidebar-integration.min.js.map